<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Eventa | @ViewBag.Title</title>
    <link rel="icon" type="image/png" href="~/Images/Eventa.png">

    <!-- ==========================================================================
         Core CSS Libraries - يجب تحميلها أولاً
         تشمل Bootstrap, Font Awesome, Bootstrap Icons, وخط Tajawal.
         ========================================================================== -->
    <link rel="stylesheet" href="~/Content/assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.1/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.1/css/v4-shims.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">


    <!-- ==========================================================================
         AdminLTE and Plugins CSS - بعد المكتبات الأساسية
         تشمل أنماط AdminLTE وإضافاته المختلفة.
         ========================================================================== -->
    <link rel="stylesheet" href="~/Content/assets/dist/css/AdminLTE.min.css">
    <link rel="stylesheet" href="~/Content/assets/dist/css/skins/_all-skins.min.css">
    <link rel="stylesheet" href="~/Content/assets/plugins/iCheck/flat/blue.css">
    <link rel="stylesheet" href="~/Content/assets/plugins/morris/morris.css">
    <link rel="stylesheet" href="~/Content/assets/plugins/jvectormap/jquery-jvectormap-1.2.2.css">
    <link rel="stylesheet" href="~/Content/assets/plugins/datepicker/datepicker3.css">
    <link rel="stylesheet" href="~/Content/assets/plugins/daterangepicker/daterangepicker-bs3.css">
    <link rel="stylesheet" href="~/Content/assets/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">
    <link rel="stylesheet" href="~/Content/assets/plugins/datatables/dataTables.bootstrap.css">
    <link rel="stylesheet" href="~/Content/assets/plugins/select2/select2.min.css">
    <link rel="stylesheet" href="~/Content/assets/plugins/summernote-0.8.18-dist/summernote.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">


    <!-- ==========================================================================
         RTL and Custom Styles - يجب تحميلها أخيراً لتجاوز الأنماط الأخرى
         تشمل أنماط RTL والأنماط المخصصة لتطبيقك.
         ========================================================================== -->
    <link rel="stylesheet" href="~/Content/assets/dist/css/bootstrap-rtl.min.css">
@*     <link rel="stylesheet" href="~/Content/assets/dist/css/rtl.css">
    <link rel="stylesheet" href="~/Content/assets/dist/css/main.css">
    <link rel="stylesheet" href="~/Content/assets/dist/css/util.css">
    <link rel="stylesheet" href="~/css/site.css">
    <link rel="stylesheet" href="~/css/splash-screen.css">
    <link rel="stylesheet" href="~/css/header-sidebar.css">
    <link rel="stylesheet" href="~/css/terms-and-conditions.css" />
    <link rel="stylesheet" href="~/css/contact-info.css" />
    <link rel="stylesheet" href="~/css/general-info.css" />
    <link rel="stylesheet" href="~/css/categories.css" /> *@


    @await RenderSectionAsync("Styles", required: false)
</head>
<body class="skin-blue sidebar-mini">
    <div id="splash-screen" class="splash-screen">
        <div class="splash-content animate__animated animate__fadeIn">
            <img src="~/Images/Eventa.png" alt="Eventa Logo" class="splash-logo animate__animated animate__pulse animate__infinite">
            <h1 class="splash-title animate__animated animate__fadeInUp animate__delay-1s">مرحبًا بك في Eventa</h1>
            <div class="splash-loader"></div>
        </div>
    </div>

    <div id="cover-spin"></div>

    <div class="wrapper">
        <div id="header-data">
            @await Component.InvokeAsync("Header")
        </div>
        @await Component.InvokeAsync("AdminSideMenu")
        <div class="content-wrapper">
            <section class="content hidden">
                @RenderBody()
            </section>
        </div>
    </div>

    <!-- ==========================================================================
         Core JS Libraries - يجب تحميلها أولاً
         تشمل jQuery, jQuery UI, Bootstrap.
         ========================================================================== -->
    <script src="~/Content/assets/plugins/jQuery/jQuery-2.1.4.min.js"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    <script src="~/Content/assets/bootstrap/js/bootstrap.min.js"></script>

    <!-- ==========================================================================
         TinyMCE - يتم تحميله بعد jQuery و Bootstrap
         ========================================================================== -->
    <script src="https://cdn.tiny.cloud/1/cm697181gs2dmxoi2sgfygjiyj6fbdgtt1f95bidkuubz1ta/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <script>
        // تهيئة TinyMCE
        tinymce.init({
            selector: '.tinymce',
            plugins: 'advlist autolink lists link image charmap print preview hr anchor pagebreak',
            toolbar: 'undo redo | formatselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image',
            menubar: false,
            directionality: function () {
                return this.getAttribute('dir') === 'rtl' ? 'rtl' : 'ltr';
            },
            content_style: 'body { font-family: Tajawal, sans-serif; }'
        });
    </script>

    <!-- ==========================================================================
         AdminLTE and Plugins JS - بعد المكتبات الأساسية و TinyMCE
         ========================================================================== -->
    <script src="~/Content/assets/plugins/sparkline/jquery.sparkline.min.js"></script>
    <script src="~/Content/assets/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
    <script src="~/Content/assets/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <script src="~/Content/assets/plugins/knob/jquery.knob.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/js/bootstrap-datetimepicker.min.js"></script>
    <script src="~/Content/assets/plugins/daterangepicker/daterangepicker.js"></script>
    <script src="~/Content/assets/plugins/datepicker/bootstrap-datepicker.js"></script>
    <script src="~/Content/assets/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
    <script src="~/Content/assets/plugins/slimScroll/jquery.slimscroll.min.js"></script>
    <script src="~/Content/assets/plugins/fastclick/fastclick.min.js"></script>
    <script src="~/Content/assets/dist/js/app.min.js"></script>
    <script src="~/Content/assets/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="~/Content/assets/plugins/datatables/dataTables.bootstrap.js"></script>
    <script src="~/Content/assets/plugins/select2/select2.full.js"></script>
    <script src="~/Content/assets/plugins/summernote-0.8.18-dist/summernote.min.js"></script>
    <script src="~/Content/assets/plugins/Toaster/toastr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.5.2/bootbox.min.js"></script>

    <!-- ==========================================================================
         Custom JS and SignalR - يتم تحميلها أخيراً
         ========================================================================== -->
    <script src="~/Content/assets/dist/js/main.js"></script>
    <script src="~/Scripts/jquery.unobtrusive-ajax.js"></script>
    <script src="~/Scripts/jquery.signalR-2.2.1.min.js"></script>
    <script src="/signalr/hubs"></script>

    <!-- ==========================================================================
         Initialize Plugins and Custom Scripts
         ========================================================================== -->
    <script>
        $(function () {
            // حل تعارض jQuery UI و Bootstrap
            $.widget.bridge('uibutton', $.ui.button);

            // تبديل الشريط الجانبي للجوال
            // تم تعديل منطق Sidebar toggle ليكون أكثر دقة
            $("body").on("click", function (e) {
                if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                    if ($(e.target).hasClass("sidebar-toggle") || $(e.target).closest(".sidebar-toggle").length) {
                        $("body").toggleClass('sidebar-open');
                    } else if (!$(e.target).closest('.main-sidebar').length && !$(e.target).closest('.sidebar-toggle').length) {
                        // إغلاق الشريط الجانبي إذا تم النقر خارج الشريط والزر
                        if ($("body").hasClass('sidebar-open')) {
                             $("body").removeClass('sidebar-open');
                        }
                    }
                }
            });

            // طلب إذن الإشعارات
            if (!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                if (Notification.permission !== "granted") {
                    Notification.requestPermission();
                }
            }

            // تهيئة Summernote (إذا كنت تستخدمه بالفعل، وإلا فقم بإزالته لتجنب التعارض مع TinyMCE)
            // إذا كنت تستخدم TinyMCE فقط، قم بإزالة هذا الكود
            $('.rich-text-editor').summernote({
                height: 500,
                focus: true
            });

            // تهيئة Select2
            $('.select2').select2({
                placeholder: 'اضغط للاختيار المتعدد',
                dir: "rtl" // إضافة هذا لضمان عمل Select2 بشكل صحيح مع RTL
            });

            // Tooltips
            $('[data-toggle="tooltip"]').tooltip();

            // إظهار شاشة التحميل عند إرسال النموذج
            $("form").submit(function () {
                // تحقق من صلاحية النموذج قبل إظهار شاشة التحميل
                if ($(this).valid()) {
                    $("#cover-spin").show();
                }
            });

            // توسيط رؤوس الجداول
            $('th').css('text-align', 'center');

            // إخفاء شاشة التحميل عند الانتهاء من تحميل الصفحة (أو عند انتهاء العمليات الأولية)
            // هذا الكود يتم تشغيله عند تحميل DOM بالكامل، وليس بالضرورة بعد تحميل كل الموارد
            $("#cover-spin").hide();
        });

        // انتقال شاشة البداية (Splash Screen)
        // يتم تشغيله بعد تحميل جميع موارد الصفحة
        window.onload = function () {
            setTimeout(function () {
                $('#splash-screen').addClass('hidden');
                $('.content').removeClass('hidden');
            }, 100); // تأخير بسيط لضمان ظهور الرسوم المتحركة
        };

        // عرض رسالة نجاح (Toast) باستخدام Toastr
        @if (TempData["Success"] != null)
        {
            <text>
                    $(function () {
                        toastr.success("@Html.Raw(TempData["Success"])"); // استخدام Html.Raw لعرض المحتوى بشكل صحيح
                    });
            </text>
        }
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
